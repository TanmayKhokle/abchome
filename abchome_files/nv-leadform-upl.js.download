window.nvpack=window.nvpack||{},window.nvpack.leadform=function(){"use strict";class i{constructor(){this.document=window.document,this.browserStatus={isSafari:0,isChrome:0,isFirefox:0,isIE:0,isSafariPush:0,isChromePush:0,isFirefoxPush:0,isEdgePush:0},this.isIncognito=0}getMobileStatus(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1:0}getBrowser(){var i,t=window.navigator.userAgent;if(document.documentMode||/Edge/.test(t)||/EdgA/.test(t)||/Edg/.test(t))this.browserStatus.isIE=1,i=/Edge/.test(t)||/EdgA/.test(t)?t.substring(t.indexOf("Edg")+5).split(".")[0]:t.substring(t.indexOf("Edg")+4).split(".")[0],this.browserStatus.isEdgePush=i>=17?1:0;else if(/chrome/i.test(t))this.browserStatus.isChrome=1,i=/Android|webOS/i.test(navigator.userAgent)?t.split("/")[t.split("/").length-2]:t.split(" ")[t.split(" ").length-2].substr(7),this.browserStatus.isChromePush=i.split(".")[0]>=42?1:0;else if(t.indexOf("Safari")>0&&-1==t.indexOf("Chrome"))this.browserStatus.isSafari=1,i=t.substring(0,t.indexOf("Safari")).substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1),this.browserStatus.isSafariPush=parseInt(i,10)>=7?1:0;else if(/firefox/i.test(t)){this.browserStatus.isFirefox=1;var n=t.indexOf("Firefox"),e=t.substring(n+8),o=parseInt(""+e,10);o=isNaN(o)?parseInt(navigator.appVersion,10):o,this.browserStatus.isFirefoxPush=o>=44&&!/Android|webOS/i.test(navigator.userAgent)||o>=48&&/Android|webOS/i.test(navigator.userAgent)?1:0}return this.browserStatus}checkIncognito(){return new Promise((i,t)=>{this.isIncognito=0;var n=this,e=window.navigator.userAgent;if(document.documentMode||/Edge/.test(e))window.indexedDB||!window.PointerEvent&&!window.MSPointerEvent?i(!1):(n.isIncognito=1,i(!0));else if(/chrome/i.test(e)){var o=window.RequestFileSystem||window.webkitRequestFileSystem;o?o(window.TEMPORARY,100,()=>i(!1),()=>{n.isIncognito=1,i(!0)}):(n.isIncognito=1,i(!0))}else if(/firefox/i.test(e)){if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var a,r;try{(a=window.indexedDB.open("test")).onerror=function(){return!0}}catch(t){r=!0,n.isIncognito=1,i(!0)}void 0===r&&function(i,t){var n=0,e=!1,o=window.setInterval(function(){i()&&(window.clearInterval(o),t(e)),n++>50&&(window.clearInterval(o),t(e=!0))},10)}(function(){return"done"===a.readyState},function(t){t||(!0===(r=!a.result)?(n.isIncognito=1,i(!0)):i(!1))})}}else if(/Safari/.test(e)){var s;try{window.openDatabase(null,null,null,null)}catch(t){"QuotaExceededError"===t.name?n.isIncognito=0:n.isIncognito=1,s=!0,i(!0)}void 0===s&&(s=!1,n.isIncognito=0,i(!1))}setTimeout(function(){i(!1)},1e3)})}getQueryValue(i){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var e=t[n].split("=");if(e[0]==i)return e[1]}}}class t{constructor(){this.document=window.document}set(i,t,n,e){var o=new Date((new Date).setHours(23,59,59,0));n=n||0==n?"expires="+n:"expires="+o,e=e?"domain=."+e:"",document.cookie=i+"="+t+"; "+n+"; "+e+"; path=/; secure"}get(i){for(var t=i+"=",n=document.cookie.split(";"),e=0;e<n.length;e++){var o=n[e].trim();if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}remove(i){document.cookie=i+"=; Max-Age=-99999999;"}lsSupport(){return!!window.localStorage}setLS(i,t){return this.lsSupport()&&localStorage.setItem(i,t)}getLS(i){return this.lsSupport()?localStorage.getItem(i):null}duration(i){var t=1,n="Fri, 31 Dec 1999 23:59:59 GMT";if(i)if(501==i)n="Fri, 31 Dec 1999 23:59:59 GMT";else if(0==i)n=0;else{500==i?t=365:i>0&&i<=90&&(t=i);var e=new Date;1!=t&&(t-=1,e.setTime(e.getTime()+24*t*60*60*1e3)),e.setHours(23,59,59,0),n=e}return n}}var n=i=>{if(i.template&&i.nid){var t=document.getElementById("nv_js-leadform-content_"+i.nid);if(t){var n=Math.min(i.height+40,window.innerHeight-20);t.style.height=n+"px",t.style.transition="all 0.3s ease-in"}}},e=(i,t)=>{0!=t&&(t=1==t?1:1e3*t,setTimeout(function(){document.getElementById(i).style.display="block"},t))},o=(i,t,n,e,o,a)=>{if(null!=n&&1!=n&&null!=e&&0==e)try{var r=0;t.repeat_form&&1==t.repeat_form&&document.querySelectorAll("div[id^=notify-visitors-]").forEach(function(i){if("visible"==i.style.visibility)return r=1,!1}),1!=r&&setTimeout(function(){if(document.getElementById(i)){document.getElementById(i).style.visibility="visible";var n=document.getElementById("nv_js-leadform_"+t.formID);t.animation&&n&&4!=t.pos&&!["71"].includes(t.template)&&(n.className+=" "+t.animation)}if("object"==typeof t){var e=a.scope.config.urls.updateView+t.brandID+"&formID="+t.formID;a.scope.getJSONP.get(e,"",a.scope.callbackName,function(){});var o=t.name?t.name:"Untitled";a.scope.gapush_leadform(t.formID,o,"nv_leadform_impressions",!0)}},o)}catch(i){console.log(i)}},a=(i,t)=>{if(i.noOfTimesPerUser){var n=parseInt(t.cookieController.get("_nv_form_shw_"+i.formID));n=n?n+1:1,t.cookieController.set("_nv_form_shw_"+i.formID,n)}},r=(i,t,n,e,o)=>{try{var a=0,r=o.scope?o.scope:o;if(e&&(e=JSON.parse(e)).repeat_form&&1==e.repeat_form&&document.querySelectorAll("div[id^=notify-visitors-]").forEach(function(i){if("visible"==i.style.visibility)return a=1,!1}),1!=a){if("box"==i){var s=document.getElementById("notify-visitors-leadform-notification_"+t),c=document.getElementById("nv_js-leadform_"+t);if(e.animation&&c&&4!=e.pos&&!["71"].includes(e.template)&&(c.className+=" "+e.animation),s){s.style.visibility="visible";var d=o.config.urls.updateView+n+"&formID="+t}}d&&(e.formID=t,((i,t)=>{if(i.repeat_view){var n={domain:location.host.split(".").splice(1).join("."),cookies:{}},e=t.cookieController.get("_nv_form_x");if(null===t.cookieController.get("_nv_form_x_"+i.formID)&&(null===e||!e.split(",").includes(i.formID))&&i.repeat_view&&""!==i.repeat_view){if(0==i.repeat_view){var o="_nv_form_x_"+i.formID,a=i.formID;e&&(a=e+","+a),n.cookies[o.substring(0,10)]=[a,259200]}else 501!=i.repeat_view&&(n.cookies["_nv_form_x_"+i.formID]=[1,1440*i.repeat_view]);t.session(n)}}})(e,r),o.getJSONP.get(d,"",o.callbackName,function(i){i&&"object"==typeof i&&i.campaignCookie&&o.session&&o.session(i.campaignCookie)}))}}catch(i){console.log(i)}},s=i=>{switch(!0){case null!=document.getElementById("nv_js-leadform-close-button_"+i):document.getElementById("nv_js-leadform-close-button_"+i).click()}},c=(i,t,n)=>{var e=document.getElementById(i);null!=e&&("hidden"===e.style.visibility?(document.getElementById(i).style.visibility="visible",document.getElementById(i).style.transition="bottom 1s ease"):(document.getElementById(i).style.visibility="hidden",document.getElementById(i).style.transition="bottom 1s ease"))},d=(i,t)=>{i&&t&&(t.nvChannel=13,nv("user",i,t))};class u{constructor(i){this.scope=i}initialize(i){var t=this,n=0,e=parseInt(t.scope.cookieController.get("_nv_form_li_"+i.notificationID));return e=e?e+1:1,t.scope.bindEvent.bind(document,"mouseout",function(a){var r=(a=a||window.event).relatedTarget||a.toElement;if((!r||"HTML"==r.nodeName)&&a.pageY-window.pageYOffset<=1&&1!=n&&(!e||e<=i.noOfTimesPerUser)){n=1,t.scope.cookieController.set("_nv_form_li_"+i.formID,e);var s="notify-visitors-leadform-notification_"+i.formID;o(s,i,0,0,0,t)}}),this}}class l{constructor(i){this.scope=i,this.value=""}initialize(i){return this.value=i,this.handleWindowLoad(),this}handleWindowLoad(){"complete"==document.readyState?this.scrollLeadform():this.scope.bindEvent.bind(window,"load",this.scrollLeadform,"banner")}scrollLeadform(){var i=this;i.scope.bindEvent.bind(document,"scroll",function t(n){var e=document.body,a=document.documentElement,r=Math.max(e.scrollHeight,e.offsetHeight,a.clientHeight,a.scrollHeight,a.offsetHeight,e.clientHeight),s=(window.pageYOffset||document.documentElement.scrollTop)/(r-window.innerHeight);if(Math.round(100*s)>=i.value.scroll){var c="notify-visitors-leadform-notification_"+i.value.formID;o(c,i.value,0,0,0,i),i.scope.bindEvent.unbind(document,"scroll",t)}})}}var f=i=>{var t=document.createElement("style");t.type="text/css",t.setAttribute("class","notify-visitors-element"),t.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(t)},m=i=>{"complete"===document.readyState?i.nvj(document).scroll(function(){if("true"==i.nvj("._hideOnScroll").attr("isScrollEnd"))return i.nvj("._hideOnScroll").attr("isScrollEnd","false"),!1;!0===i.isScrollTrue?i.isScrollTrue=!1:(i.nvj("._hideOnScroll").fadeOut(),clearTimeout(i.nvj.data(this,"scrollCheck")),i.nvj.data(this,"scrollCheck",setTimeout(function(){i.nvj("._hideOnScroll").attr("isScrollEnd","true"),i.nvj("._hideOnScroll").fadeIn(),i.isScrollTrue=!0},1e3)))}):window.onload=m(i)};class h{constructor(i){this.scope=i}leadform(i,t){if(!document.getElementById("notify-visitors-leadform-notification_"+i.formID)){a(i,this.scope),i.close_btn&&e("nv_js-leadform-close-button_"+i.formID,i.close_btn),f(i.animation_style);var n=document.createElement("div");if(n.innerHTML=i.html.box_view,n.id="notify-visitors-leadform-notification_"+i.formID,n.style.visibility="hidden",null!=i.embbed_id&&""!==i.embbed_id){var o=document.getElementById(i.embbed_id);if(!o)return!1;o.appendChild(n)}else document.body.firstChild?document.body.insertBefore(n,document.body.firstChild):document.body.appendChild(n);if(i.html.iframe_data){var r=document.getElementById("nv_leadform_content-iframe_"+i.formID).contentWindow.document;r.open(),r.write(i.html.iframe_data),r.close()}if(1==i.hideOnScroll)document.getElementById("notify-visitors-leadform-notification_"+i.formID).className+=" _hideOnScroll",m(this.scope);this.initialize(i)}}leaveIntent(i){this.scope.nvLeaveIntentController.initialize(i)}scrollEvent(i){this.scope.nvScrollController.initialize(i)}initialize(i){var t,n,e,o=this;if(1==i.minimize){var a=this.scope.cookieController.get("_nv_form_min_"+i.formID);a&&1==a&&o.minimize(i)}if(t=document.getElementById("nv_js-leadform-close-button_"+i.formID),o.scope.bindEvent.bind(t,"click",function(){return o.close(i,1,i.repeat_close)}),(n=document.getElementById("nv_js-leadform-minimize-button_"+i.formID))&&o.scope.bindEvent.bind(n,"click",function(){return o.minimize(i,1)}),(e=document.getElementById("nv_js-leadform-maximise-button_"+i.formID))&&o.scope.bindEvent.bind(e,"click",function(){return o.minimize(i)}),71==i.template||70==i.template&&2==i.user_device){var r=document.getElementById("nv_js-modal-overlay");0!=i.close_btn&&setTimeout(function(){o.scope.bindEvent.bind(document,"keydown",function(t){if(27===t.keyCode)return o.close(i)}),o.scope.bindEvent.bind(r,"click",function(t){return o.close(i)})},1e3*i.close_btn)}return this}minimize(i,t){null!=t&&this.scope.cookieController.set("_nv_form_min_"+i.formID,1),c("nv_leadform_content-iframe_"+i.formID),c("nv_js-leadform_"+i.formID),c("nv_js-leadform-maximise-button_"+i.formID)}close(i,t,n,e){var o={domain:location.host.split(".").splice(1).join("."),cookies:{}};if(73!=i.template){var a=this.scope.cookieController.get("_nv_form_x");if(null===this.scope.cookieController.get("_nv_form_x_"+i.formID)&&t&&(null===a||!a.split(",").includes(i.formID))){if(n&&""!==n)if(0==n){var r="_nv_form_x_"+i.formID,s=i.formID;a&&(s=a+","+s),o.cookies[r.substring(0,10)]=[s,259200]}else 501!=n&&(o.cookies["_nv_form_x_"+i.formID]=[1,1440*n]);else o.cookies["_nv_form_x_"+i.formID]=[i.formID,259200];this.scope.session(o)}if(!e){var c=document.getElementById("notify-visitors-leadform-notification_"+i.formID);c&&c.parentNode.removeChild(c)}}}}var v=()=>{var i,t,n=window.document,e=0;return{get:function(o,a,r,s){var c=-1!==o.indexOf("?")?"&":"?";a=a||{};var d=g();for(t in d&&Array.isArray(d)&&d.length>0&&(a.cookieData=d.join(";")),notify_visitors&&notify_visitors.cookie_domain&&(a.cookieDomain=notify_visitors.cookie_domain),a)a.hasOwnProperty(t)&&(c+=encodeURIComponent(t)+"="+encodeURIComponent(a[t])+"&");var u=r+ ++e;return window[u]=function(i){s(i);try{delete window[u]}catch(i){}window[u]=null},function(t){var e=n.createElement("script"),o=!1;e.src=t,e.async=!0,e.onload=e.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,e.onload=e.onreadystatechange=null,e&&e.parentNode&&e.parentNode.removeChild(e))},!i&&(i=n.getElementsByTagName("head")[0]),i.appendChild(e)}(o+c+"js_callback="+u),u},post:function(i,t,n,e,o){o.ajax({url:i,type:"POST",data:t,contentType:!1,processData:!1,success:e})}}},w=()=>{return{bind:function(i,t,n,e){return e&&""!=e&&(window.notify_visitors.eventsRecord=window.notify_visitors.eventsRecord||{},window.notify_visitors.eventsRecord[e]=window.notify_visitors.eventsRecord[e]||[],window.notify_visitors.eventsRecord[e].push({n:t,e:i,c:n})),i.addEventListener?i.addEventListener(t,n):i.attachEvent?i.attachEvent("on"+t,n):void 0},unbind:function(i,t,n){return i.removeEventListener?i.removeEventListener(t,n):i.detachEvent?i.detachEvent("on"+t,n):void 0}}},_=()=>{return function(){if("function"==typeof window.CustomEvent)return!1;function i(i,t){t=t||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(i,t.bubbles,t.cancelable,t.detail),n}i.prototype=window.Event.prototype,window.CustomEvent=i}(),{send:function(i,t){var n=new CustomEvent("notifyvisitors_callback",{detail:{data:i,url:document.location.href,type:t}});window.dispatchEvent(n)}}},b=()=>{var i,t=!0,n={},e=!1;function o(i){e=!0,clearInterval(i),t&&setTimeout(function(){a("selfCall")},10)}function a(i,e,o,r,s){i&&(void 0===s&&(s=!0),t&&("function"==typeof ga?"selfCall"===i?Object.keys(n).forEach(function(i){if(i&&n[i]&&n[i].length>0){for(var t=0;t<n[i].length;t++)ga(i+".send","event",n[i][t][1],n[i][t][2],n[i][t][3],1,{nonInteraction:n[i][t][4]});n[i]=[]}}):ga(i+".send","event",e,o,r,1,{nonInteraction:s}):"function"==typeof gtag?"selfCall"===i?Object.keys(n).forEach(function(i){if(i&&n[i]&&n[i].length>0){for(var t=0;t<n[i].length;t++)gtag("event",i,{category:n[i][t][1],campaign:n[i][t][3]});n[i]=[]}}):gtag("event",o,{category:e,campaign:r}):"selfCall"!==i?(n[i]||(n[i]=[]),n[i].push([i,e,o,r,s])):setTimeout(function(){a("selfCall")},100)))}return{send:a,create:function a(r,s){if(r)if("undefined"!=typeof ga&&ga.loaded&&"function"==typeof ga)try{if(s)ga("create",s,"auto",{name:r});else if(ga.getAll&&Array.isArray(ga.getAll())&&ga.getAll().length>0){var c=ga.getAll()[0].get("trackingId"),d=ga.getByName(r);c&&!d&&(ga("create",c,"auto",{name:r}),o(i))}}catch(i){}else e||i||(i=setInterval(function(){a(r)},250),setTimeout(function(){i&&(t=!1,n={},o(i))},6e4))}}},g=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[];if(document&&document.cookie){var n=document.cookie.split(";");"all"===i&&(t=n),Array.isArray(i)&&n&&n.length>0&&(t=n.filter(function(t){var n=t.trim().split("=")[0];return!!i.includes(n)||0===n.indexOf("_nv_")}))}return t},p={updateView:"https://mail.notifyvisitors.com/user/forms_V1/updateViews?brandID=",getLeadForm:"https://www.notifyvisitors.com/ext/v1/getLeadForm"},y=new Date;class k{constructor(n){this.response={},this.session=n.data&&n.data.session||"",this.config=this.config||{},this.data=this.data||{},this.getJSONP=v(),this.bindEvent=w(),this.callbackNotifyEvent=_(),this.callbackName="nvform_json",this.cookieController=new t,this.browserController=new i,this.nvLeaveIntentController=new u(this),this.nvScrollController=new l(this),this.widgetController=new h(this),this.init=this.init.bind(this),this.checkAuth(n.Form.data),this.gaEvent=b();var e=n.Form.data.gaEvents||null;this.trackingID=e&&e.trackingID?e.trackingID:"",this.gaEvent.create("NV_Leadform",this.trackingID)}checkAuth(i){this.response=i,null!=i.auth&&this.handleWindowLoad()}handleWindowLoad(){"complete"==document.readyState?this.init():this.bindEvent.bind(window,"load",this.init,"leadform")}init(){if(nvpack.config=nvpack.config||{},nvpack.config.l)return!1;nvpack.config.l=!0,this.config.urls=p,this.data.auth=this.response.auth||{},this.data.setting=this.response.auth||{},this.response.ruleData&&(this.data.setting.ruleData=this.data.ruleData=this.response.ruleData),this.response.tokens&&(this.data.setting.tokens=this.data.tokens=this.response.tokens),this.data.setting.trafficSource=this.data.auth.trafficSource=document.referrer,this.data.setting.pageUrl=this.data.auth.pageUrl=document.location,this.data.setting.gmOffset=this.data.auth.gmOffset=60*y.getTimezoneOffset()*-1,this.data.setting.screenWidth=this.data.auth.screenWidth=screen.width,this.data.setting.screenHeight=this.data.auth.screenHeight=screen.height,window.notify_visitors.manual=window.notify_visitors.manual||{},window.notify_visitors.manual.gapush_leadform=this.gapush_leadform.bind(this),window.notify_visitors.manual.onclickForm=this.onclick.bind(this),this.messageListener(),this.load(),this.callbackNotifyEvent.send("leadform_init","loadscript")}load(){if("fail"==this.response.Authentication)return!1;this.browserController.getBrowser(),!1===(window!==window.parent)&&(""!=this.response.cookie_domain&&(this.data.cookie_domain=this.response.cookie_domain),this.response.leadForms&&this.response.leadForms.length>0&&this.handleLeadFormResponse())}handleLeadFormResponse(){this.data.tokensQuery=this.data.tokens?"&tokens="+encodeURIComponent(this.data.tokens):"";var i=0,t=this.response.leadForms;if(t&&t.length>0)for(var n=0;n<t.length;n++)!navigator.cookieEnabled&&t[n].noOfTimesPerUser<5||0!=i&&t[n].sequence!=i||(i=t[n].sequence,1==t[n].leaveIntent&&this.widgetController.leaveIntent(t[n]),null!=t[n].scroll&&t[n].scroll>0&&this.widgetController.scrollEvent(t[n]),f(".nv-animated{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.nv-animated.infinite{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}.nv-animated.hinge{-webkit-animation-duration:2s;animation-duration:2s}.nv-animated.bounceIn,.nv-animated.bounceOut,.nv-animated.flipOutX,.nv-animated.flipOutY{-webkit-animation-duration:.75s;animation-duration:.75s}"),this.widgetController.leadform(t[n]))}messageListener(){var i=this;window.addEventListener("message",function(t){try{var e=JSON.parse(t.data);if(e&&"object"==typeof e&&null!=e[0])switch(e[0]){case"nv_leadform_NotifyVisitors":e[4]=!!e[4]&&e[4],i.gapush_leadform(e[2],e[1],e[3],e[4]);break;case"nv_leadform_iphone":i.iphoneRedirect(e[1],e[2]);break;case"nv_leadform_autoclose":s(e[1]);break;case"nv_leadform_repeat_submit":e.formID=e[1],i.widgetController.close(e,1,e[2],1);break;case"nv_leadform_changeHeight":n(e[1]);break;case"nv_leadform_iframeDisplay":r(e[1],e[2],e[3],e[4],i);break;case"nv_leadform_userCode":d(e[1],e[2])}}catch(i){}},!1)}onclick(i){null!=i.leadFormID&&(this.data.setting.leadFormID=i.leadFormID,this.data.setting.tokens=this.data.tokens?JSON.stringify(this.data.tokens):"",this.getJSONP.get(this.config.urls.getLeadForm,this.data.setting,this.callbackName,this.onclickResponse.bind(this)))}onclickResponse(i){if(null!=i&&null!=i.leadFormInfo){var t=i.leadFormInfo;f(".nv-animated{-webkit-animation-duration:1s;animation-duration:1s;-webkit-animation-fill-mode:both;animation-fill-mode:both}.nv-animated.infinite{-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite}.nv-animated.hinge{-webkit-animation-duration:2s;animation-duration:2s}.nv-animated.bounceIn,.nv-animated.bounceOut,.nv-animated.flipOutX,.nv-animated.flipOutY{-webkit-animation-duration:.75s;animation-duration:.75s}"),this.widgetController.leadform(t)}}gapush_leadform(i,t,n,e){this.response&&this.response.gaEvents&&Array.isArray(this.response.gaEvents.events)&&this.response.gaEvents.events.includes(n)&&this.gaEvent.send("NV_Leadform","NotifyVisitors",n,i+" - "+t,e)}iphoneRedirect(i){i&&(window.location.href=i)}}return new k(window.notify_visitors),k}();
